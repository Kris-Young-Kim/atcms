# λ°μ΄ν„° μ•”νΈν™” μ „λµ

**ν”„λ΅μ νΈ μ½”λ“**: ATCMP-2026  
**μ‘μ„±μΌ**: 2025-11-01  
**λ²„μ „**: 1.0

---

## π“‹ κ°μ”

AT-CMP ν”„λ΅μ νΈμ λ°μ΄ν„° μ•”νΈν™” μ „λµ λ¬Έμ„μ…λ‹λ‹¤. μ΄ λ¬Έμ„λ” μ „μ†΅ μ¤‘ λ° μ €μ¥ μ‹ λ°μ΄ν„° λ³΄νΈ λ°©λ²•μ„ μ •μν•©λ‹λ‹¤.

---

## π― λ©ν‘

1. **μ „μ†΅ μ¤‘ λ°μ΄ν„° λ³΄νΈ**: HTTPS/TLSλ¥Ό ν†µν• μ•”νΈν™” ν†µμ‹ 
2. **μ €μ¥ μ‹ λ°μ΄ν„° λ³΄νΈ**: λ―Όκ° λ°μ΄ν„° ν•„λ“ μ•”νΈν™”
3. **ν‚¤ κ΄€λ¦¬**: μ•”νΈν™” ν‚¤μ μ•μ „ν• κ΄€λ¦¬ λ° μν™
4. **κ·μ • μ¤€μ**: κ°μΈμ •λ³΄λ³΄νΈλ²• μ¤€μ

---

## π” λ―Όκ° λ°μ΄ν„° μ‹λ³„

### 1. κ°μΈμ •λ³΄ (clients ν…μ΄λΈ”)

**λ†’μ€ λ―Όκ°λ„:**
- `birth_date`: μƒλ…„μ›”μΌ (κ°μΈμ‹λ³„μ •λ³΄)
- `contact_phone`: μ „ν™”λ²νΈ (κ°μΈμ‹λ³„μ •λ³΄)
- `contact_email`: μ΄λ©”μΌ μ£Όμ† (κ°μΈμ‹λ³„μ •λ³΄)
- `address`: μ£Όμ† (κ°μΈμ‹λ³„μ •λ³΄)
- `guardian_name`: λ³΄νΈμ μ΄λ¦„
- `guardian_phone`: λ³΄νΈμ μ „ν™”λ²νΈ

**μ¤‘κ°„ λ―Όκ°λ„:**
- `name`: μ΄λ¦„
- `gender`: μ„±λ³„
- `disability_type`: μ¥μ•  μ ν•
- `disability_grade`: μ¥μ•  λ“±κΈ‰

**λ‚®μ€ λ―Όκ°λ„:**
- `referral_source`: μλΆ° κ²½λ΅
- `notes`: λ©”λ¨

### 2. μ„λΉ„μ¤ κΈ°λ΅ (service_records ν…μ΄λΈ”)

**λ†’μ€ λ―Όκ°λ„:**
- `content`: μƒλ‹΄/ν‰κ°€ λ‚΄μ© (SOAP ν•μ‹, κ±΄κ°•μ •λ³΄ ν¬ν•¨)
- `attachments`: μ²¨λ¶€νμΌ (κ±΄κ°•μ •λ³΄, κ°μΈμ •λ³΄ ν¬ν•¨ κ°€λ¥)

**μ¤‘κ°„ λ―Όκ°λ„:**
- `title`: κΈ°λ΅ μ λ©
- `record_date`: μ„λΉ„μ¤ μ κ³µμΌ

### 3. κ°μ‚¬ λ΅κ·Έ (audit_logs ν…μ΄λΈ”)

**λ†’μ€ λ―Όκ°λ„:**
- `actor_id`: μ‚¬μ©μ ID (Clerk User ID)
- `metadata`: λ©”νƒ€λ°μ΄ν„° (κ°μΈμ •λ³΄ ν¬ν•¨ κ°€λ¥)

**μ¤‘κ°„ λ―Όκ°λ„:**
- `action`: μ‘μ—… μ΄λ¦„
- `tags`: λ¶„λ¥ νƒκ·Έ

### 4. μΈμ¦ μ •λ³΄

**λ§¤μ° λ†’μ€ λ―Όκ°λ„:**
- Clerk API ν‚¤ (μ„λ²„ μ „μ©)
- Supabase Service Role Key (μ„λ²„ μ „μ©)
- ν™κ²½ λ³€μ (`.env.local`)

---

## π” μ „μ†΅ μ¤‘ μ•”νΈν™” (TLS/HTTPS)

### ν„μ¬ μƒνƒ

β… **Vercel μλ™ HTTPS**
- Vercelμ€ λ¨λ“  λ°°ν¬μ— μλ™μΌλ΅ SSL μΈμ¦μ„λ¥Ό μ κ³µν•©λ‹λ‹¤
- HTTPSκ°€ κΈ°λ³Έμ μΌλ΅ ν™μ„±ν™”λμ–΄ μμµλ‹λ‹¤
- Let's Encrypt μΈμ¦μ„λ¥Ό μλ™μΌλ΅ κ°±μ‹ ν•©λ‹λ‹¤

β… **Supabase μ—°κ²°**
- Supabase APIλ” HTTPSλ¥Ό ν†µν•΄μ„λ§ μ ‘κ·Ό κ°€λ¥ν•©λ‹λ‹¤
- λ°μ΄ν„°λ² μ΄μ¤ μ—°κ²°μ€ TLS 1.2 μ΄μƒμ„ μ‚¬μ©ν•©λ‹λ‹¤

### κµ¬ν„ ν™•μΈ

**Next.js API Routes:**
- λ¨λ“  API μ—”λ“ν¬μΈνΈλ” HTTPSλ¥Ό ν†µν•΄ μ κ³µλ©λ‹λ‹¤
- Vercelμ—μ„ μλ™μΌλ΅ μ²λ¦¬λ©λ‹λ‹¤

**Supabase ν΄λΌμ΄μ–ΈνΈ:**
```typescript
// Supabase ν΄λΌμ΄μ–ΈνΈλ” HTTPSλ¥Ό ν†µν•΄ μ—°κ²°λ©λ‹λ‹¤
const supabase = createClient(
  process.env.NEXT_PUBLIC_SUPABASE_URL!, // https://*.supabase.co
  process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!
);
```

### κ°•μ  HTTPS μ„¤μ •

**next.config.tsμ—μ„ HTTPS κ°•μ :**
```typescript
// ν”„λ΅λ•μ… ν™κ²½μ—μ„ HTTPS κ°•μ  (Vercelμ—μ„ μλ™ μ²λ¦¬)
const nextConfig = {
  // ... κΈ°νƒ€ μ„¤μ •
};
```

**μ°Έκ³ **: Vercelμ€ μλ™μΌλ΅ HTTPSλ¥Ό κ°•μ ν•λ―€λ΅ μ¶”κ°€ μ„¤μ •μ΄ ν•„μ” μ—†μµλ‹λ‹¤.

---

## π”’ μ €μ¥ μ‹ μ•”νΈν™”

### 1. Supabase λ°μ΄ν„°λ² μ΄μ¤ μ•”νΈν™”

**ν„μ¬ μƒνƒ:**
- β… Supabaseλ” PostgreSQL λ°μ΄ν„°λ² μ΄μ¤λ¥Ό μ•”νΈν™”λ μƒνƒλ΅ μ €μ¥ν•©λ‹λ‹¤
- β… λ””μ¤ν¬ λ λ²¨ μ•”νΈν™” (at-rest encryption)μ΄ κΈ°λ³Έ ν™μ„±ν™”λμ–΄ μμµλ‹λ‹¤
- β… λ„¤νΈμ›ν¬ μ „μ†΅ μ‹ TLS μ•”νΈν™”κ°€ μ μ©λ©λ‹λ‹¤

**Supabase μ•”νΈν™” κΈ°λ¥:**
- **λ””μ¤ν¬ μ•”νΈν™”**: λ¨λ“  λ°μ΄ν„°λ” μ•”νΈν™”λ μƒνƒλ΅ μ €μ¥λ©λ‹λ‹¤
- **λ°±μ—… μ•”νΈν™”**: λ°±μ—… νμΌλ„ μ•”νΈν™”λ©λ‹λ‹¤
- **λ„¤νΈμ›ν¬ μ•”νΈν™”**: λ¨λ“  μ—°κ²°μ€ TLSλ΅ μ•”νΈν™”λ©λ‹λ‹¤

### 2. μ»¬λΌ λ λ²¨ μ•”νΈν™” (μ„ νƒμ‚¬ν•­)

**ν•„μ” μ‹ κµ¬ν„:**
- PostgreSQLμ `pgcrypto` ν™•μ¥μ„ μ‚¬μ©ν•μ—¬ νΉμ • μ»¬λΌλ§ μ•”νΈν™” κ°€λ¥
- ν„μ¬λ” Supabaseμ κΈ°λ³Έ μ•”νΈν™”λ§μΌλ΅ μ¶©λ¶„ν•©λ‹λ‹¤

**κµ¬ν„ μμ‹ (ν•„μ” μ‹):**
```sql
-- pgcrypto ν™•μ¥ ν™μ„±ν™”
CREATE EXTENSION IF NOT EXISTS pgcrypto;

-- μ•”νΈν™”λ μ»¬λΌ μ¶”κ°€
ALTER TABLE clients ADD COLUMN encrypted_phone BYTEA;

-- μ•”νΈν™” ν•¨μ
CREATE OR REPLACE FUNCTION encrypt_phone(phone TEXT)
RETURNS BYTEA AS $$
BEGIN
  RETURN pgp_sym_encrypt(phone, current_setting('app.encryption_key'));
END;
$$ LANGUAGE plpgsql;

-- λ³µνΈν™” ν•¨μ
CREATE OR REPLACE FUNCTION decrypt_phone(encrypted BYTEA)
RETURNS TEXT AS $$
BEGIN
  RETURN pgp_sym_decrypt(encrypted, current_setting('app.encryption_key'));
END;
$$ LANGUAGE plpgsql;
```

**ν„μ¬ κ¶μ¥μ‚¬ν•­:**
- Supabaseμ κΈ°λ³Έ μ•”νΈν™”λ§μΌλ΅ μ¶©λ¶„ν•©λ‹λ‹¤
- μ¶”κ°€ μ»¬λΌ λ λ²¨ μ•”νΈν™”λ” ν–¥ν›„ ν•„μ” μ‹ κµ¬ν„ κ²€ν† 

### 3. Supabase Storage μ•”νΈν™”

**ν„μ¬ μƒνƒ:**
- β… Supabase Storageλ” νμΌμ„ μ•”νΈν™”λ μƒνƒλ΅ μ €μ¥ν•©λ‹λ‹¤
- β… μ—…λ΅λ“λ νμΌμ€ μ•”νΈν™”λ©λ‹λ‹¤
- β… λ‹¤μ΄λ΅λ“ μ‹ HTTPSλ¥Ό ν†µν•΄ μ „μ†΅λ©λ‹λ‹¤

**νμΌ λ³΄μ•:**
- κ³µκ° λ²„ν‚·: URLμ„ μ•λ©΄ λ„κµ¬λ‚ μ ‘κ·Ό κ°€λ¥ (μλ„λ λ™μ‘)
- λΉ„κ³µκ° λ²„ν‚·: μ„λ…λ URLμ„ ν†µν•΄μ„λ§ μ ‘κ·Ό κ°€λ¥ (ν–¥ν›„ κµ¬ν„ κ³ λ ¤)

---

## π”‘ μ•”νΈν™” ν‚¤ κ΄€λ¦¬

### 1. ν™κ²½ λ³€μ κ΄€λ¦¬

**ν„μ¬ κµ¬ν„:**
- β… ν™κ²½ λ³€μλ” `.env.local` νμΌμ— μ €μ¥ (λ΅μ»¬ κ°λ°)
- β… Vercel Secretsμ— μ €μ¥ (ν”„λ΅λ•μ…)
- β… `.gitignore`μ— `.env.local` ν¬ν•¨

**ν‚¤ μΆ…λ¥:**
- **Clerk API ν‚¤**: μΈμ¦ μ„λΉ„μ¤ ν‚¤
- **Supabase Anon Key**: κ³µκ° ν‚¤ (λΈλΌμ°μ € λ…Έμ¶ κ°€λ¥)
- **Supabase Service Role Key**: μ„λ²„ μ „μ© ν‚¤ (μ λ€ λΈλΌμ°μ € λ…Έμ¶ κΈμ§€)

### 2. ν‚¤ μν™ μ •μ±…

**κ¶μ¥ μν™ μ£ΌκΈ°:**
- **Service Role Key**: λ¶„κΈ°λ³„ 1ν μ΄μƒ
- **Clerk Secret Key**: λ¶„κΈ°λ³„ 1ν μ΄μƒ
- **Supabase Anon Key**: μ—°κ°„ 1ν μ΄μƒ

**μν™ μ μ°¨:**
1. μƒ ν‚¤ μƒμ„± (Supabase/Clerk Dashboard)
2. Vercel ν™κ²½ λ³€μ μ—…λ°μ΄νΈ
3. λ°°ν¬ λ° ν…μ¤νΈ
4. κµ¬ ν‚¤ λΉ„ν™μ„±ν™” (24μ‹κ°„ ν›„)

### 3. ν‚¤ μ €μ¥μ†

**λ΅μ»¬ κ°λ°:**
- `.env.local` νμΌ (`.gitignore`μ— ν¬ν•¨)
- κ°λ°μλ³„λ΅ λ³„λ„ κ΄€λ¦¬

**ν”„λ΅λ•μ…:**
- Vercel Dashboard β†’ Settings β†’ Environment Variables
- ν™κ²½λ³„λ΅ λ¶„λ¦¬ κ΄€λ¦¬ (Production, Preview, Development)

**ν€ κ³µμ :**
- λΉ„λ°€λ²νΈ κ΄€λ¦¬ λ„κµ¬ μ‚¬μ© (1Password, Bitwarden λ“±)
- μ½”λ“μ— μ§μ ‘ ν¬ν•¨ κΈμ§€

---

## π›΅οΈ λ°μ΄ν„° λ³΄νΈ μ „λµ

### 1. μ ‘κ·Ό μ μ–΄

**μ• ν”λ¦¬μΌ€μ΄μ… λ λ²¨ μ ‘κ·Ό μ μ–΄:**
- β… Clerk μΈμ¦μΌλ΅ μ‚¬μ©μ μΈμ¦
- β… μ—­ν•  κΈ°λ° μ ‘κ·Ό μ μ–΄ (RBAC)
- β… API Routeμ—μ„ κ¶ν• κ²€μ¦

**λ°μ΄ν„°λ² μ΄μ¤ λ λ²¨:**
- β οΈ RLS λ―Έμ‚¬μ© (μ• ν”λ¦¬μΌ€μ΄μ… λ λ²¨ μ ‘κ·Ό μ μ–΄ μ‚¬μ©)
- β… λ¨λ“  μ ‘κ·Όμ€ μ• ν”λ¦¬μΌ€μ΄μ…μ„ ν†µν•΄μ„λ§ κ°€λ¥

### 2. λ°μ΄ν„° λ§μ¤ν‚Ή

**λ΅κ·Έ μ¶λ ¥ μ‹:**
```typescript
// λ―Όκ° μ •λ³΄ λ§μ¤ν‚Ή
function maskPhone(phone: string): string {
  if (!phone) return '';
  return phone.replace(/(\d{3})-(\d{4})-(\d{4})/, '$1-****-$3');
}

function maskEmail(email: string): string {
  if (!email) return '';
  const [local, domain] = email.split('@');
  return `${local.slice(0, 2)}***@${domain}`;
}
```

**μ—λ¬ λ©”μ‹μ§€:**
- ν”„λ΅λ•μ… ν™κ²½μ—μ„λ” λ―Όκ° μ •λ³΄λ¥Ό μ—λ¬ λ©”μ‹μ§€μ— ν¬ν•¨ν•μ§€ μ•μ
- κ°μ‚¬ λ΅κ·Έμ—λ§ μƒμ„Έ μ •λ³΄ κΈ°λ΅

### 3. λ°μ΄ν„° λ³΄μ΅΄ λ° μ‚­μ 

**λ³΄μ΅΄ κΈ°κ°„:**
- λ€μƒμ μ •λ³΄: λ²•μ  λ³΄μ΅΄ κΈ°κ°„ μ¤€μ (ν†µμƒ 5λ…„)
- κ°μ‚¬ λ΅κ·Έ: μµμ† 1λ…„ λ³΄μ΅΄

**λ°μ΄ν„° μ‚­μ :**
- μΆ…κ²°λ λ€μƒμ μ •λ³΄λ” μ•”νΈν™”λ μƒνƒλ΅ λ³΄κ΄€
- μ™„μ „ μ‚­μ  μ”μ²­ μ‹ μ•μ „ν•κ² μ‚­μ  (GDPR μ¤€μ)

---

## π“‹ κµ¬ν„ μ²΄ν¬λ¦¬μ¤νΈ

### μ „μ†΅ μ¤‘ μ•”νΈν™”
- [x] Vercel HTTPS μλ™ ν™μ„±ν™” ν™•μΈ
- [x] Supabase HTTPS μ—°κ²° ν™•μΈ
- [x] λ¨λ“  API μ—”λ“ν¬μΈνΈ HTTPS ν™•μΈ
- [ ] HTTPS κ°•μ  μ„¤μ • ν™•μΈ (Vercel μλ™ μ²λ¦¬)

### μ €μ¥ μ‹ μ•”νΈν™”
- [x] Supabase λ””μ¤ν¬ μ•”νΈν™” ν™•μΈ
- [x] Supabase λ°±μ—… μ•”νΈν™” ν™•μΈ
- [x] Supabase Storage μ•”νΈν™” ν™•μΈ
- [ ] μ»¬λΌ λ λ²¨ μ•”νΈν™” ν•„μ”μ„± κ²€ν†  (ν„μ¬ λ¶ν•„μ”)

### ν‚¤ κ΄€λ¦¬
- [x] ν™κ²½ λ³€μ `.gitignore` ν™•μΈ
- [x] Vercel Secrets μ„¤μ • λ°©λ²• λ¬Έμ„ν™”
- [ ] ν‚¤ μν™ μ •μ±… μλ¦½
- [ ] ν‚¤ μν™ μ μ°¨ λ¬Έμ„ν™”

### λ°μ΄ν„° λ³΄νΈ
- [x] μ ‘κ·Ό μ μ–΄ κµ¬ν„ ν™•μΈ
- [ ] λ°μ΄ν„° λ§μ¤ν‚Ή μ ν‹Έλ¦¬ν‹° ν•¨μ μ‘μ„±
- [ ] λ°μ΄ν„° λ³΄μ΅΄ μ •μ±… μλ¦½
- [ ] λ°μ΄ν„° μ‚­μ  μ μ°¨ λ¬Έμ„ν™”

---

## π”„ ν–¥ν›„ κ°μ„  μ‚¬ν•­

### 1. μ»¬λΌ λ λ²¨ μ•”νΈν™” (ν•„μ” μ‹)
- νΉμ • λ―Όκ° ν•„λ“λ§ μ¶”κ°€ μ•”νΈν™”
- `pgcrypto` ν™•μ¥ ν™μ©
- μ•”νΈν™”/λ³µνΈν™” ν•¨μ κµ¬ν„

### 2. λΉ„κ³µκ° Storage λ²„ν‚·
- ν„μ¬λ” κ³µκ° λ²„ν‚· μ‚¬μ©
- ν–¥ν›„ λ―Όκ° νμΌμ€ λΉ„κ³µκ° λ²„ν‚· + μ„λ…λ URL μ‚¬μ© κ³ λ ¤

### 3. ν‚¤ μν™ μλ™ν™”
- GitHub Actionsλ΅ ν‚¤ μν™ μλ™ν™”
- μ•λ¦Ό μ‹μ¤ν… κµ¬μ¶•

### 4. λ°μ΄ν„° λ§μ¤ν‚Ή μλ™ν™”
- λ΅κ·Έ μ¶λ ¥ μ‹ μλ™ λ§μ¤ν‚Ή
- κ°λ° ν™κ²½μ—μ„λ§ μ „μ²΄ μ •λ³΄ ν‘μ‹

---

## π“ μ°Έκ³  μλ£

- [Supabase Security](https://supabase.com/docs/guides/database/postgres/security)
- [PostgreSQL Encryption](https://www.postgresql.org/docs/current/encryption-options.html)
- [OWASP Encryption Cheat Sheet](https://cheatsheetseries.owasp.org/cheatsheets/Cryptographic_Storage_Cheat_Sheet.html)
- [κ°μΈμ •λ³΄λ³΄νΈλ²•](https://www.law.go.kr/λ²•λ Ή/κ°μΈμ •λ³΄λ³΄νΈλ²•)

---

## π”— κ΄€λ ¨ λ¬Έμ„

- [λ³΄μ• μ²΄ν¬λ¦¬μ¤νΈ](./security-checklist.md)
- [ν™κ²½ λ³€μ μ„¤μ •](../web/ENV_SETUP.md)
- [λ°°ν¬ κ°€μ΄λ“](../DEPLOYMENT.md)
- [λ°μ΄ν„°λ² μ΄μ¤ μ¤ν‚¤λ§](../DATABASE_SCHEMA.md)

---

**λ§μ§€λ§‰ μ—…λ°μ΄νΈ**: 2025-11-01  
**λ‹¤μ κ²€ν† μΌ**: 2026-02-01

